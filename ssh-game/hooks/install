#!/bin/bash
set -e

# Install dependencies
apt-get install -y git netcat ssh

# Download files
cd /home
rm -rf juju-ctf
git clone https://github.com/oparkins/juju-ctf
cd juju-ctf/ssh-game/

if [ $(id -u billy) -eq 1 ]
then
	useradd -ms /bin/bash billy
fi

if [ $(id -u sue) -eq 1 ]
then
	useradd -ms /bin/bash sue
fi

if [ $(id -u bob) -eq 1 ]
then
	useradd -ms /bin/bash bob
fi

cp resources/billy.flag /home/billy/
mkdir -p /home/billy/.ssh
cat resources/billy.pub >> /home/billy/.ssh/authorized_keys
chown -R billy:billy /home/billy
chmod 700 /home/billy/.ssh/authorized_keys

cp resources/sue.flag /home/sue/
mkdir -p /home/sue/.ssh
cat resources/sue.pub >> /home/sue/.ssh/authorized_keys
chown -R sue:sue /home/sue
chmod 700 /home/sue/.ssh/authorized_keys

