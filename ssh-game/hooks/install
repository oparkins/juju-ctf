#!/bin/bash
set -e
fail=1
# Install dependencies
apt-get install -y git netcat ssh

# Download files
cd /home
rm -rf juju-ctf
git clone https://github.com/oparkins/juju-ctf
cd juju-ctf/ssh-game/

if [ $(id -u billy) -eq 1 ]
then
	useradd -ms /bin/bash billy
fi

id -u sue
if [ $? -eq 1 ]
then
	useradd -ms /bin/bash sue
fi

id -u bob
if [ $? -eq 1 ]
then
	useradd -ms /bin/bash bob
fi

mkdir -p /home/billy/.ssh
cp resources/billy.flag /home/billy/
cat resources/billy.pub >> /home/billy/.ssh/authorized_keys
chown -R billy:billy /home/billy
chmod 700 /home/billy/.ssh/authorized_keys

mkdir -p /home/sue/.ssh
cp resources/sue.flag /home/sue/
cat resources/sue.pub >> /home/sue/.ssh/authorized_keys
chown -R sue:sue /home/sue
chmod 700 /home/sue/.ssh/authorized_keys

