#!/bin/bash
set -e

status-set maintenance "Instaling required tools"
# Install dependencies
apt-get install -y git apache2 netcat php ssh libapache2-mod-php php-mcrypt

# Download files
cd /home
rm -rf juju-ctf
git clone https://github.com/oparkins/juju-ctf
cd juju-ctf/php-exploit/

# setup website
rm -rf /var/www/html
cp -r resources/html /var/www/


# add new user
if id -u sue >/dev/null 2>&1;
then
	echo "sue Exists"
else
	useradd -ms /bin/bash sue
fi

## add new user ssh key
mkdir -p /home/sue/.ssh
cp resources/id_rsa /home/sue/.ssh/

## Setup exploit
chmod u+s /usr/bin/find

cp resources/nc.flag /var/www/html/
chown www-data:www-data /var/www/html/nc.flag

status-set blocked "Need to start service"

